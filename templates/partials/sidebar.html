{#
  Sidebar partial ‚Äî templates/partials/sidebar.html
  Included by base.html via {% include "partials/sidebar.html" %}

  current_page(request) is a Jinja2 global function (registered in pages.py)
  that maps request.url.path ‚Üí a page-key string.
  All active-state logic is plain string comparison: no computations in Jinja.
#}
{% set cp = current_page(request) %}
{% set in_finance = cp in ['wallets', 'transactions', 'categories', 'goals', 'subscriptions', 'planned-ops'] %}
{% set in_tasks   = cp in ['tasks', 'projects', 'habits', 'events', 'wishes', 'task-categories', 'task-presets', 'task-reschedule-reasons', 'knowledge'] %}
{% set in_system  = cp in ['contacts', 'profile'] %}
{% set in_admin   = cp == 'admin' %}

<aside class="sidebar" id="sidebar">

  {# ‚îÄ‚îÄ Logo ‚îÄ‚îÄ #}
  <div class="sidebar-logo">
    <div class="sidebar-logo-title">FinLife</div>
    <div class="sidebar-logo-sub">Life OS</div>
  </div>

  <nav class="sidebar-nav">

    {# ‚îÄ‚îÄ Primary screens (always visible) ‚îÄ‚îÄ #}
    <div class="nav-primary-group">
      <a href="/" class="nav-link nav-primary{% if cp == 'dashboard' %} active{% endif %}">
        Dashboard
      </a>
      <a href="/plan" class="nav-link nav-primary{% if cp == 'plan' %} active{% endif %}">
        –ü–ª–∞–Ω
      </a>
      <a href="/budget" class="nav-link nav-primary{% if cp == 'budget' %} active{% endif %}">
        –ë—é–¥–∂–µ—Ç
      </a>
      <a href="/strategy" class="nav-link nav-primary{% if cp == 'strategy' %} active{% endif %}">
        <span class="nav-icon">üìä</span>–°—Ç—Ä–∞—Ç–µ–≥–∏—è
      </a>
      <a href="/efficiency" class="nav-link nav-primary{% if cp == 'efficiency' %} active{% endif %}">
        <span class="nav-icon">‚ö°</span>–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
      </a>
      <a href="/notifications" class="nav-link nav-primary{% if cp == 'notifications' %} active{% endif %}" style="position:relative;">
        <span class="nav-icon">üîî</span>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        <span id="notifBadge" style="display:none; position:absolute; top:6px; right:10px;
          background:#dc3545; color:#fff; font-size:10px; font-weight:700;
          min-width:16px; height:16px; padding:0 3px;
          border-radius:8px; line-height:16px; text-align:center;"></span>
      </a>
    </div>

    {# ‚îÄ‚îÄ –§–ò–ù–ê–ù–°–´ ‚îÄ‚îÄ #}
    <details class="nav-group" id="grp-finance"
      {% if in_finance %}data-force-open="true"{% endif %}
      open>
      <summary class="nav-group-hdr">
        <span class="nav-group-label">–§–∏–Ω–∞–Ω—Å—ã</span>
        <span class="nav-chevron">&#9658;</span>
      </summary>
      <div class="nav-group-body">
        <a href="/wallets"
           class="nav-link{% if cp == 'wallets' %} active{% endif %}">
          <span class="nav-icon">üí∞</span>–î–µ–Ω—å–≥–∏
        </a>
        <a href="/transactions"
           class="nav-link{% if cp == 'transactions' %} active{% endif %}">
          –û–ø–µ—Ä–∞—Ü–∏–∏
        </a>
        <a href="/categories"
           class="nav-link{% if cp == 'categories' %} active{% endif %}">
          –ö–∞—Ç–µ–≥–æ—Ä–∏–∏
        </a>
        <a href="/goals"
           class="nav-link{% if cp == 'goals' %} active{% endif %}">
          –¶–µ–ª–∏
        </a>
        <a href="/subscriptions"
           class="nav-link{% if cp == 'subscriptions' %} active{% endif %}">
          –ü–æ–¥–ø–∏—Å–∫–∏
        </a>
        <a href="/planned-ops"
           class="nav-link{% if cp == 'planned-ops' %} active{% endif %}">
          –ü–ª–∞–Ω–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
        </a>
      </div>
    </details>

    {# ‚îÄ‚îÄ –î–ï–õ–ê ‚îÄ‚îÄ #}
    <details class="nav-group" id="grp-tasks"
      {% if in_tasks %}data-force-open="true"{% endif %}
      open>
      <summary class="nav-group-hdr">
        <span class="nav-group-label">–î–µ–ª–∞</span>
        <span class="nav-chevron">&#9658;</span>
      </summary>
      <div class="nav-group-body">
        <a href="/tasks"
           class="nav-link{% if cp == 'tasks' %} active{% endif %}">
          –ó–∞–¥–∞—á–∏
        </a>
        <a href="/projects"
           class="nav-link{% if cp == 'projects' %} active{% endif %}">
          –ü—Ä–æ–µ–∫—Ç—ã
        </a>
        <a href="/habits"
           class="nav-link{% if cp == 'habits' %} active{% endif %}">
          –ü—Ä–∏–≤—ã—á–∫–∏
        </a>
        <a href="/events"
           class="nav-link{% if cp == 'events' %} active{% endif %}">
          –°–æ–±—ã—Ç–∏—è
        </a>
        <a href="/wishes"
           class="nav-link{% if cp == 'wishes' %} active{% endif %}">
          –•–æ—Ç–µ–ª–∫–∏
        </a>
        <a href="/task-categories"
           class="nav-link{% if cp == 'task-categories' %} active{% endif %}">
          –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–µ–ª
        </a>
        <a href="/task-presets"
           class="nav-link{% if cp == 'task-presets' %} active{% endif %}">
          –®–∞–±–ª–æ–Ω—ã –∑–∞–¥–∞—á
        </a>
        <a href="/task-reschedule-reasons"
           class="nav-link{% if cp == 'task-reschedule-reasons' %} active{% endif %}">
          –ü—Ä–∏—á–∏–Ω—ã –ø–µ—Ä–µ–Ω–æ—Å–∞
        </a>
        <a href="/knowledge"
           class="nav-link{% if cp == 'knowledge' %} active{% endif %}">
          –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π
        </a>
      </div>
    </details>

    {# ‚îÄ‚îÄ –°–ò–°–¢–ï–ú–ê (collapsed by default) ‚îÄ‚îÄ #}
    <details class="nav-group" id="grp-system"
      {% if in_system %}data-force-open="true" open{% endif %}>
      <summary class="nav-group-hdr">
        <span class="nav-group-label">–°–∏—Å—Ç–µ–º–∞</span>
        <span class="nav-chevron">&#9658;</span>
      </summary>
      <div class="nav-group-body">
        <a href="/contacts"
           class="nav-link{% if cp == 'contacts' %} active{% endif %}">
          –ö–æ–Ω—Ç–∞–∫—Ç—ã
        </a>
        <a href="/profile"
           class="nav-link{% if cp == 'profile' %} active{% endif %}">
          –ü—Ä–æ—Ñ–∏–ª—å
        </a>
      </div>
    </details>

    {% if request.session.get('is_admin') %}
    <details class="nav-group" id="grp-admin"
      {% if in_admin %}data-force-open="true" open{% endif %}>
      <summary class="nav-group-hdr">
        <span class="nav-group-label">Admin</span>
        <span class="nav-chevron">&#9658;</span>
      </summary>
      <div class="nav-group-body">
        <a href="/admin/overview"
           class="nav-link{% if in_admin %} active{% endif %}">
          –û–±–∑–æ—Ä
        </a>
      </div>
    </details>
    {% endif %}

  </nav>

  <div class="sidebar-bottom">
    <button id="themeToggle" onclick="toggleTheme()" class="sidebar-theme-btn">
      <span id="themeIcon" style="font-size:15px;">üåô</span>
      <span id="themeLabel">–¢—ë–º–Ω–∞—è —Ç–µ–º–∞</span>
    </button>
    <a href="/logout" class="sidebar-logout">&#8594; –í—ã—Ö–æ–¥</a>
  </div>

</aside>
