{#
  Sidebar partial ‚Äî templates/partials/sidebar.html
  Included by base.html via {% include "partials/sidebar.html" %}

  current_page(request) is a Jinja2 global function (registered in pages.py)
  that maps request.url.path ‚Üí a page-key string.
  All active-state logic is plain string comparison: no computations in Jinja.
#}
{% set cp = current_page(request) %}
{% set in_finance = cp in ['wallets', 'transactions', 'categories', 'goals', 'subscriptions', 'planned-ops'] %}
{% set in_tasks   = cp in ['tasks', 'projects', 'habits', 'events', 'wishes', 'task-categories', 'task-presets', 'task-reschedule-reasons'] %}
{% set in_system  = cp in ['contacts', 'profile'] %}
{% set in_admin   = cp == 'admin' %}

<aside class="sidebar" id="sidebar">
  <div class="sidebar-logo">FinLife</div>

  <nav class="sidebar-nav">

    {# ‚îÄ‚îÄ Primary screens (always visible, no collapse) ‚îÄ‚îÄ #}
    <div class="nav-primary-group">
      <a href="/" class="nav-link nav-primary{% if cp == 'dashboard' %} active{% endif %}">
        <span class="nav-icon">‚óâ</span>Dashboard
      </a>
      <a href="/plan" class="nav-link nav-primary{% if cp == 'plan' %} active{% endif %}">
        <span class="nav-icon">‚ò∞</span>–ü–ª–∞–Ω
      </a>
      <a href="/budget" class="nav-link nav-primary{% if cp == 'budget' %} active{% endif %}">
        <span class="nav-icon">‚óà</span>–ë—é–¥–∂–µ—Ç
      </a>
    </div>

    <div class="nav-sep"></div>

    {# ‚îÄ‚îÄ –§–ò–ù–ê–ù–°–´ (open by default) ‚îÄ‚îÄ #}
    <details class="nav-group" id="grp-finance"
      {% if in_finance %}data-force-open="true"{% endif %}
      open>
      <summary class="nav-group-hdr">
        <span class="nav-group-label">–§–∏–Ω–∞–Ω—Å—ã</span>
        <span class="nav-chevron">&#9658;</span>
      </summary>
      <div class="nav-group-body">
        <a href="/wallets"
           class="nav-link{% if cp == 'wallets' %} active{% endif %}">
          <span class="nav-icon">‚óã</span>–î–µ–Ω—å–≥–∏
        </a>
        <a href="/transactions"
           class="nav-link{% if cp == 'transactions' %} active{% endif %}">
          <span class="nav-icon">‚Üï</span>–û–ø–µ—Ä–∞—Ü–∏–∏
        </a>
        <a href="/categories"
           class="nav-link{% if cp == 'categories' %} active{% endif %}">
          <span class="nav-icon">‚â°</span>–§–∏–Ω. –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        </a>
        <a href="/goals"
           class="nav-link{% if cp == 'goals' %} active{% endif %}">
          <span class="nav-icon">‚óé</span>–¶–µ–ª–∏
        </a>
        <a href="/subscriptions"
           class="nav-link{% if cp == 'subscriptions' %} active{% endif %}">
          <span class="nav-icon">‚Ü∫</span>–ü–æ–¥–ø–∏—Å–∫–∏
        </a>
        <a href="/planned-ops"
           class="nav-link{% if cp == 'planned-ops' %} active{% endif %}">
          <span class="nav-icon">‚ñ∑</span>–ü–ª–∞–Ω–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
        </a>
      </div>
    </details>

    <div class="nav-sep"></div>

    {# ‚îÄ‚îÄ –î–ï–õ–ê (open by default) ‚îÄ‚îÄ #}
    <details class="nav-group" id="grp-tasks"
      {% if in_tasks %}data-force-open="true"{% endif %}
      open>
      <summary class="nav-group-hdr">
        <span class="nav-group-label">–î–µ–ª–∞</span>
        <span class="nav-chevron">&#9658;</span>
      </summary>
      <div class="nav-group-body">
        <a href="/tasks"
           class="nav-link{% if cp == 'tasks' %} active{% endif %}">
          <span class="nav-icon">‚òê</span>–ó–∞–¥–∞—á–∏
        </a>
        <a href="/projects"
           class="nav-link{% if cp == 'projects' %} active{% endif %}">
          <span class="nav-icon">‚ñ¶</span>–ü—Ä–æ–µ–∫—Ç—ã
        </a>
        <a href="/habits"
           class="nav-link{% if cp == 'habits' %} active{% endif %}">
          <span class="nav-icon">‚Üª</span>–ü—Ä–∏–≤—ã—á–∫–∏
        </a>
        <a href="/events"
           class="nav-link{% if cp == 'events' %} active{% endif %}">
          <span class="nav-icon">‚óã</span>–°–æ–±—ã—Ç–∏—è
        </a>
        <a href="/wishes"
           class="nav-link{% if cp == 'wishes' %} active{% endif %}">
          <span class="nav-icon">‚òÜ</span>–•–æ—Ç–µ–ª–∫–∏
        </a>
        <a href="/task-categories"
           class="nav-link{% if cp == 'task-categories' %} active{% endif %}">
          <span class="nav-icon">‚â°</span>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–µ–ª
        </a>
        <a href="/task-presets"
           class="nav-link{% if cp == 'task-presets' %} active{% endif %}">
          <span class="nav-icon">‚äû</span>–®–∞–±–ª–æ–Ω—ã –∑–∞–¥–∞—á
        </a>
        <a href="/task-reschedule-reasons"
           class="nav-link{% if cp == 'task-reschedule-reasons' %} active{% endif %}">
          <span class="nav-icon">&#8634;</span>–ü—Ä–∏—á–∏–Ω—ã –ø–µ—Ä–µ–Ω–æ—Å–∞
        </a>
      </div>
    </details>

    <div class="nav-sep"></div>

    {# ‚îÄ‚îÄ –°–ò–°–¢–ï–ú–ê (collapsed by default) ‚îÄ‚îÄ #}
    <details class="nav-group" id="grp-system"
      {% if in_system %}data-force-open="true" open{% endif %}>
      <summary class="nav-group-hdr">
        <span class="nav-group-label">–°–∏—Å—Ç–µ–º–∞</span>
        <span class="nav-chevron">&#9658;</span>
      </summary>
      <div class="nav-group-body">
        <a href="/contacts"
           class="nav-link{% if cp == 'contacts' %} active{% endif %}">
          <span class="nav-icon">‚óâ</span>–ö–æ–Ω—Ç–∞–∫—Ç—ã
        </a>
        <a href="/profile"
           class="nav-link{% if cp == 'profile' %} active{% endif %}">
          <span class="nav-icon">‚óå</span>–ü—Ä–æ—Ñ–∏–ª—å
        </a>
      </div>
    </details>

    {% if request.session.get('is_admin') %}
    <div class="nav-sep"></div>
    <a href="/admin/overview" class="nav-link nav-primary{% if in_admin %} active{% endif %}">
      <span class="nav-icon">&#9881;</span>Admin
    </a>
    {% endif %}

  </nav>

  <div class="sidebar-bottom">
    <button id="themeToggle" onclick="toggleTheme()" class="sidebar-theme-btn">
      <span id="themeIcon" style="font-size:15px;">üåô</span>
      <span id="themeLabel">–¢—ë–º–Ω–∞—è —Ç–µ–º–∞</span>
    </button>
    <a href="/logout" class="sidebar-logout">&#8594; –í—ã—Ö–æ–¥</a>
  </div>
</aside>
