{% extends "base.html" %}

{% block title %}{% if mode == 'create' %}–ù–æ–≤–∞—è —Ö–æ—Ç–µ–ª–∫–∞{% else %}–ò–∑–º–µ–Ω–∏—Ç—å —Ö–æ—Ç–µ–ª–∫—É{% endif %}{% endblock %}

{% block content %}
<div style="padding: 20px; max-width: 600px;">
    <h2 style="font-size: 20px; font-weight: 600; margin-bottom: 20px;">
        {% if mode == 'create' %}–ù–æ–≤–∞—è —Ö–æ—Ç–µ–ª–∫–∞{% else %}–ò–∑–º–µ–Ω–∏—Ç—å —Ö–æ—Ç–µ–ª–∫—É{% endif %}
    </h2>

    {% set error = request.query_params.get('error') %}
    {% if error %}
    <div class="notice-error" style="padding: 12px 16px; border-radius: 6px; margin-bottom: 16px; font-size: 13px;">
        {{ error }}
    </div>
    {% endif %}

    <form method="POST" action="{% if mode == 'create' %}/wishes/new{% else %}/wishes/{{ wish.wish_id }}/edit{% endif %}"
          class="form-section" style="border-radius: 8px; padding: 20px;">

        <!-- Title -->
        <div style="margin-bottom: 16px;">
            <label style="display: block; font-size: 13px; font-weight: 500; margin-bottom: 6px; color: #333;">
                –ù–∞–∑–≤–∞–Ω–∏–µ <span style="color: #f44336;">*</span>
            </label>
            <input type="text" name="title" required
                   value="{% if wish %}{{ wish.title }}{% endif %}"
                   style="width: 100%; padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
        </div>

        <!-- Type -->
        <div style="margin-bottom: 16px;">
            <label style="display: block; font-size: 13px; font-weight: 500; margin-bottom: 6px; color: #333;">
                –¢–∏–ø <span style="color: #f44336;">*</span>
            </label>
            <select name="wish_type" required
                    style="width: 100%; padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                <option value="PURCHASE" {% if wish and wish.wish_type == 'PURCHASE' %}selected{% endif %}>üí∞ –ü–æ–∫—É–ø–∫–∞</option>
                <option value="EVENT" {% if wish and wish.wish_type == 'EVENT' %}selected{% endif %}>üéâ –°–æ–±—ã—Ç–∏–µ</option>
                <option value="PLACE" {% if wish and wish.wish_type == 'PLACE' %}selected{% endif %}>üåç –ú–µ—Å—Ç–æ</option>
                <option value="OTHER" {% if wish and wish.wish_type == 'OTHER' %}selected{% endif %}>üìù –î—Ä—É–≥–æ–µ</option>
            </select>
        </div>

        <!-- Status -->
        <div style="margin-bottom: 16px;">
            <label style="display: block; font-size: 13px; font-weight: 500; margin-bottom: 6px; color: #333;">
                –°—Ç–∞—Ç—É—Å <span style="color: #f44336;">*</span>
            </label>
            <select name="status" required
                    style="width: 100%; padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                <option value="IDEA" {% if not wish or wish.status == 'IDEA' %}selected{% endif %}>üí° –ò–¥–µ—è</option>
                <option value="CONSIDERING" {% if wish and wish.status == 'CONSIDERING' %}selected{% endif %}>ü§î –î—É–º–∞—é</option>
                <option value="PLANNED" {% if wish and wish.status == 'PLANNED' %}selected{% endif %}>üìÖ –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ</option>
                <option value="DONE" {% if wish and wish.status == 'DONE' %}selected{% endif %}>‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ</option>
                <option value="CANCELED" {% if wish and wish.status == 'CANCELED' %}selected{% endif %}>‚ùå –û—Ç–º–µ–Ω–µ–Ω–æ</option>
            </select>
        </div>

        <!-- Target date OR target month -->
        <div style="margin-bottom: 16px; display: flex; gap: 12px;">
            <div style="flex: 1;">
                <label style="display: block; font-size: 13px; font-weight: 500; margin-bottom: 6px; color: #333;">
                    –¶–µ–ª–µ–≤–∞—è –¥–∞—Ç–∞
                </label>
                <input type="date" name="target_date" id="target_date"
                       value="{% if wish and wish.target_date %}{{ wish.target_date.strftime('%Y-%m-%d') }}{% endif %}"
                       onchange="clearTargetMonth()"
                       style="width: 100%; padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
            </div>
            <div style="flex: 1;">
                <label style="display: block; font-size: 13px; font-weight: 500; margin-bottom: 6px; color: #333;">
                    –¶–µ–ª–µ–≤–æ–π –º–µ—Å—è—Ü
                </label>
                <input type="month" name="target_month" id="target_month"
                       value="{% if wish and wish.target_month %}{{ wish.target_month }}{% endif %}"
                       onchange="clearTargetDate()"
                       style="width: 100%; padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
            </div>
        </div>
        <div style="font-size: 11px; color: #999; margin-top: -10px; margin-bottom: 16px;">
            –£–∫–∞–∂–∏—Ç–µ –ª–∏–±–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –¥–∞—Ç—É, –ª–∏–±–æ –º–µ—Å—è—Ü (–Ω–µ –æ–±–∞ —Å—Ä–∞–∑—É)
        </div>

        <!-- Estimated amount -->
        <div style="margin-bottom: 16px;">
            <label style="display: block; font-size: 13px; font-weight: 500; margin-bottom: 6px; color: #333;">
                –û—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω–∞—è —Å—É–º–º–∞ (—Ä—É–±.)
            </label>
            <input type="number" name="estimated_amount" step="0.01" min="0"
                   value="{% if wish and wish.estimated_amount %}{{ wish.estimated_amount }}{% endif %}"
                   style="width: 100%; padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
        </div>

        <!-- Is recurring -->
        <div style="margin-bottom: 16px;">
            <label style="display: flex; align-items: center; cursor: pointer;">
                <input type="checkbox" name="is_recurring" value="true"
                       {% if wish and wish.is_recurring %}checked{% endif %}
                       style="width: 16px; height: 16px; margin-right: 8px; cursor: pointer;">
                <span style="font-size: 13px; color: #333;">
                    ‚ôªÔ∏è –ü–æ–≤—Ç–æ—Ä—è—é—â–∞—è—Å—è —Ö–æ—Ç–µ–ª–∫–∞
                </span>
            </label>
            <div style="font-size: 11px; color: #999; margin-left: 24px; margin-top: 4px;">
                –ü—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å –Ω–µ –∏–∑–º–µ–Ω–∏—Ç—Å—è, —Ç–æ–ª—å–∫–æ –æ–±–Ω–æ–≤–∏—Ç—Å—è –¥–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
            </div>
        </div>

        <!-- Notes -->
        <div style="margin-bottom: 20px;">
            <label style="display: block; font-size: 13px; font-weight: 500; margin-bottom: 6px; color: #333;">
                –ó–∞–º–µ—Ç–∫–∏
            </label>
            <textarea name="notes" rows="3"
                      style="width: 100%; padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; resize: vertical;"
            >{% if wish and wish.notes %}{{ wish.notes }}{% endif %}</textarea>
        </div>

        <!-- Buttons -->
        <div style="display: flex; gap: 10px;">
            <button type="submit"
                    style="background: #4CAF50; color: white; padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 500;">
                {% if mode == 'create' %}–°–æ–∑–¥–∞—Ç—å{% else %}–°–æ—Ö—Ä–∞–Ω–∏—Ç—å{% endif %}
            </button>
            <a href="/wishes"
               class="btn-cancel" style="padding: 10px 20px; border-radius: 6px; text-decoration: none; font-size: 14px; display: inline-block;">
                –û—Ç–º–µ–Ω–∞
            </a>
        </div>
    </form>
</div>

<script>
function clearTargetDate() {
    const targetMonth = document.getElementById('target_month');
    if (targetMonth.value) {
        document.getElementById('target_date').value = '';
    }
}

function clearTargetMonth() {
    const targetDate = document.getElementById('target_date');
    if (targetDate.value) {
        document.getElementById('target_month').value = '';
    }
}
</script>
{% endblock %}
